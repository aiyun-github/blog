# 踩的坑
## 0. vs code下载缓慢解决办法

从[官网](https://code.visualstudio.com/Download)下载的vscode 链接如下，下载非常慢，因为是国外的镜像，可能需要翻墙。

原下载链接：

```http
https://az764295.vo.msecnd.net/stable/fd6f3bce6709b121a895d042d343d71f317d74e7/VSCodeUserSetup-x64-1.54.2.exe
```

使用国内镜像：在**/stable**前配置，将域名改成[**vscode.cdn.azure.cn**](https://links.jianshu.com/go?to=https%3A%2F%2Flink.zhihu.com%2F%3Ftarget%3Dhttp%3A%2F%2Fvscode.cdn.azure.cn%2F)，就非常快了

更改后的下载链接

```http
https://vscode.cdn.azure.cn/stable/fd6f3bce6709b121a895d042d343d71f317d74e7/VSCodeUserSetup-x64-1.54.2.exe
```


## 1.`<a-select>`中的`placeholder`默认显示不生效

代码：

```html
<a-select
                            show-search
                            option-filter-prop="children"
                            style="width: 340px;"
                            :filter-option="filterOption"
                            placeholder="请选择数据集!"
                            v-decorator="['datasetId', { rules: [{ required: true, message: '请选择数据集！' }] }]"
                    >
                        <a-select-option
                                v-for="item in datasetList"
                                :key="item.datasetId"
                                :value="item.datasetId"
                        >
                            {{ item.dataset }}
                        </a-select-option>
                    </a-select>
```

```javascript
// 生成FAQ 回显
        showFaqModal(record) {
            this.visible = true;
            this.editId = record.id
            this.$nextTick(function () {
                this.form.setFieldsValue({
                    question: record.question,
                    answer: record.answer,
                    sourceId: record.id,
                    datasetId: undefined, // 必须为undefined，placeholder默认显示才生效
                })
                getMountFaq().then(res => {
                    if (res.statusCode === 200) {
                        this.datasetList = res.data.datasetList
                    }
                })
            })
        },
```

解决办法：

antd本身的问题，a-select绑定的值初始为”“或为null都不行，必须设为undefined，才显示默认提示
## 2. react项目中路由找不到对应组件报错

报错原文：

```shell
./src/pages/SystemMsg/index.jsx
Module not found: Can't resolve '@compontents/SideMenu/index' in '/Users/wangaiyun/Desktop/work/metis-knowledge-web/src/pages/SystemMsg'
Compiling...
Failed to compile.
```

报错解释：根据路由找不到相应组件
原代码：

```javascript
import SideMenu from '@components/SideMenu/index'
```

解决方法：在`@`后加个斜杠`/`
修改后代码：

```javascript
import SideMenu from '@/components/SideMenu/index'
```

## 3. andt-tree

```vue
<template>
    <div>
        <a-modal
                :title="title"
                :visible="visible"
                :confirm-loading="confirmLoading"
                @ok="handleSubmit"
                @cancel="handleCancel"
        >
            <b>{{ tip }}</b><br/><br/>
            <a-radio-group v-model="value" @change="onChangeRadio">
                <a-radio :style="radioStyle" :value="1">
                    全部用户
                </a-radio>
                <a-radio :style="radioStyle" :value="2">
                    特定组织结构
                </a-radio>
            </a-radio-group>
            <div v-if="value === 2" class="tree-box">
                <a-input-search v-model="searchStr" placeholder="输入搜选项" style="width:200px;" @change="onSearch"></a-input-search>
                <a-tree
                        v-model="checkedKeys"
                        checkable
                        :auto-expand-parent="autoExpandParent"
                        :defaultExpandAll="defaultExpandAll"
                        :expanded-keys="expandedKeys"
                        :tree-data="treeData"
                        :selected-keys="selectedKeys"
                        :replaceFields="replaceFields"
                        @expand="onExpand"
                        @select="onSelect"
                >
                    <template slot='title' slot-scope="{name}">
                        <span v-html="name.replace(new RegExp(searchValue, 'g'),'<span style=color:#f50>' + searchValue + '</span>')"></span>
                    </template>
                </a-tree>
            </div>
        </a-modal>
    </div>
</template>
<script>
import { getAllOrg } from '@/api/skill';

export default {
    name: 'SkillShared',
    props: {
        visible: {
            type: Boolean,
            default: false,
        },
        confirmLoading: {
            type: Boolean,
            default: false,
        },
        title: {
            type: String,
            default: '共享能力'
        },
        tip: {
            type: String,
            default: '请选择需要共享此能力的范围：'
        },
    },
    data() {
        return {
            value: 1,
            radioStyle: {
                display: 'block',
                height: '30px',
                lineHeight: '30px',
            },
            backupsExpandedKeys: [],
            autoExpandParent: true,
            defaultExpandAll: true,
            expandedKeys: [],
            selectedKeys: [],
            searchStr: '',
            searchValue: '',
            checkedKeys: [],
            treeData: [],
            replaceFields: {
                title: 'name',
                key: 'id'
            },
        };
    },
    watch: {
        checkedKeys(val) {
            // this.expandedKeys = val
        },
        visible() {
            this.value = 1
            this.checkedKeys = []
        }
    },
    methods: {
        async getAllOrgTree() {
            let res = await getAllOrg()
            this.treeData = res?.data || []
        },
        // 确定-功能能力
        handleSubmit() {
            this.$emit('complete', this.checkedKeys)
        },
        // 取消-关闭弹框
        handleCancel() {
            this.$emit('cancle')
        },
        // 切换单选框触发
        onChangeRadio(e) {
            this.checkedKeys = []
            this.expandedKeys = [];
        },
        // 展开/收起节点时触发
        onExpand(expandedKeys) {
            this.expandedKeys = expandedKeys;
            this.autoExpandParent = false;
        },
        // 点击复选框触发
        onCheck(checkedKeys) {
            this.checkedKeys = checkedKeys;
        },
        // 点击树节点触发
        onSelect(selectedKeys, info) {
            this.selectedKeys = selectedKeys;
        },
        // 点击搜索进行模糊筛选
        onSearch() {
            const _this = this;
            // 只点击搜索才触发
            _this.searchValue = _this.searchStr;
            // 如果搜索值为空，则不展开任何项，expandedKeys置为空
            // 如果搜索值不位空，则expandedKeys的值要为搜索值的父亲及其所有祖先
            if (_this.searchValue === '') {
                _this.expandedKeys = [];
            } else {
                // 首先将展开项与展开项副本置为空
                _this.expandedKeys = [];
                _this.backupsExpandedKeys = [];
                // 获取所有存在searchValue的节点
                let candidateKeysList = _this.getkeyList(_this.searchValue, _this.treeData, []);
                // 遍历满足条件的所有节点
                candidateKeysList.map(
                    item => {
                        let key = _this.getParentKey(item, this.treeData);
                        console.log(key, ',,,,,,,')
                        if (key && !_this.backupsExpandedKeys.some(item => item === key)) {
                            _this.backupsExpandedKeys.push(key);
                        }
                    }
                )
                let length = this.backupsExpandedKeys.length;
                for (let i = 0; i < length; i++) {
                    _this.getAllParentKey(_this.backupsExpandedKeys[i], _this.treeData)
                }
                _this.expandedKeys = _this.backupsExpandedKeys.slice();
                _this.autoExpandParent = true
            }
        },
        // 获取节点中含有value的所有key集合
        getkeyList(value, tree, keyList) {
            for (let i = 0; i < tree.length; i++) {
                let node = tree[i];
                node.scopedSlots = { title: 'title' }
                if (node.name.indexOf(value) > -1) {
                    keyList.push(node.id);
                }
                if (node.children) {
                    this.getkeyList(value, node.children, keyList);
                }
            }
            return keyList;
        },

        // 该递归主要用于获取key的父亲节点的key值
        getParentKey(key, tree) {
            let parentKey;
            for (let i = 0; i < tree.length; i++) {
                const node = tree[i];
                if (node.children) {
                    if (node.children.some(item => item.id === key)) {
                        parentKey = node.id;
                    } else if (this.getParentKey(key, node.children)) {
                        parentKey = this.getParentKey(key, node.children);
                    }
                }
            }
            return parentKey;
        },
        // 获取该节点的所有祖先节点
        getAllParentKey(key, tree) {
            let parentKey
            if (key) {
                // 获得父亲节点
                parentKey = this.getParentKey(key, tree);
                if (parentKey) {
                    // 如果父亲节点存在，判断是否已经存在于展开列表里，不存在就进行push
                    if (!this.backupsExpandedKeys.some(item => item === parentKey)) {
                        this.backupsExpandedKeys.push(parentKey)
                    }
                    // 继续向上查找祖先节点
                    this.getAllParentKey(parentKey, tree)
                }
            }
        },
    },
    created() {
        this.getAllOrgTree()
    },
};
</script>
<style>
.tree-box{
    height: 50%;
}
</style>
```

## 4. antd-upload 再次打开modal上传文件时清空缓存

需求：再次上传清空列表缓存

1.  使用 `v-if`
**原理：**
`v-if`切换有一个局部编译/卸载的过程，切换过程中合适地销毁和重建内部的事件监听和子组件。 
2.  使用 `Math.random()`
**原理：**
`Math.random()`获得的值是一个随机数，这样在每次打开弹窗的时候，`Upload` 组件得到的 `key` 值就是唯一值。 

```vue
<a-modal
                    v-model="uploadVisible"
                    title="导入"
                    :confirm-loading="uploadConfirmLoading"
                    @ok="handleUploadFile"
                    @cancel="handleUploadCancel"
                    >
                    <div :key="Math.random()"> // 随机数，使每次Upload组件得到的key值是唯一值
                        <a-upload-dragger
                                v-if="uploadVisible" // data里面先给到uploadVisible为false
                                accept=".xlsx, .xls"
                                :multiple="true"
                                :showUploadList="true"
                                :headers="headers"
                                :beforeUpload="beforeUpload"
                                :data="{datasetId: dataSetId}"
                                @change="handleFileChange"
                        >
                            <p class="ant-upload-drag-icon">
                                <hz-icon type="icon-shangchuan1" />
                            </p>
                            <p class="ant-upload-text">
                                将文件拖拽至此或 <a>点击导入</a>
                            </p>
                            <p class="ant-upload-hint">
                                支持单个/多个文件上传，文件格式支持Excel，文件大小不操作100M
                            </p>
                        </a-upload-dragger>
										</div>
                </a-modal>
```

## 5.回显显示/n换行

```html
<!-- 使用pre标签：-->

<pre></pre>
/* 使用pre-line属性 */
white-space: pre-line;
```

## 6.输入中文逗号自动转为英文逗号

```javascript
<input
                    onafterpaste="this.value = this.value.replace(/，/g,',')"
                    onkeyup="this.value = this.value.replace(/，/g,',')"
            />
```

onafterpaste：粘贴触发

onkeyup：键盘触发

## 7.词槽不分页、英文名重复校验

## 8.带斜杠的json格式化展示

```javascript

<pre>{{JSON.stringify(JSON.parse(response), null, 2)}}</pre>
```

## 9.浏览器报400，终端请求却成功

1.浏览器调用接口，打开控制台-`Network`-在接口名上点击鼠标右键-点击Copy- 点击Copy as cURL

2.将复制的cURL中的请求地址 `http://localhost:8080/qa/knowledgeFeedback/search` 改为服务器地址 `http://192.../qa/knowledgeFeedback/search`

3.修改后打开Mac终端，复制修改后的cURL回车运行，发现请求成功

原因：后面检查发现是后端给的接口前缀和前端定的代理前缀冲突，后端接口前缀/a/b/...，前端之前分别定过/a和/b的
解决：后端修改前缀

```javascript
curl 'http://192...' \
  -H 'Accept: application/json,text/plain,*/*' \
  -H 'Accept-Language: zh-CN,zh;q=0.9' \
  -H 'Connection: keep-alive' \
  -H 'Content-Type: application/json' \
  -H 'Cookie: Webstorm-d356b471=c7f219c7-68fb-4bbb-904d-884d8df66752; JSESSIONID=fb3c25dd-4ad6-4075-b892-f7a0a5fbcc87' \
  -H 'Origin: http://localhost:8080' \
  -H 'Referer: http://localhost:8080/' \
  -H 'Sec-Fetch-Dest: empty' \
  -H 'Sec-Fetch-Mode: cors' \
  -H 'Sec-Fetch-Site: same-origin' \
  -H 'User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/101.0.4951.54 Safari/537.36' \
  -H 'X-metis-platform: KQA' \
  -H 'X-metis-token: fb3c25dd-4ad6-4075-b892-f7a0a5fbcc87' \
  -H 'sec-ch-ua: " Not A;Brand";v="99", "Chromium";v="101", "Google Chrome";v="101"' \
  -H 'sec-ch-ua-mobile: ?0' \
  -H 'sec-ch-ua-platform: "macOS"' \
  --data-raw '{"pageNum":1,"pageSize":10}' \
  --compressed
```

## 10. ants-form-自定义校验

```javascript
rules: {
                word: [
                    { required: true, message: '请输入领域词！' },
                ],
                synonyms: [
                    { validator: this.checkSymbol },
                    { validator: this.lengthLimit }
                ],
            },
```

```
// 符号只能输入英文的逗号校验(只能输入中文、英文、数字、英文逗号,)
        checkSymbol(rule, value, callback) {
            let rgx = /[^\a-\z\A-\Z0-9\u4E00-\u9FA5\,]/g
            if (!rgx.test(value)) {
                callback()
            } else {
                callback(new Error('同义词字段不可包含英文逗号以外的标点符号，请检查'))
            }
        },
        // 同义词长度校验
        lengthLimit(rule, value, callback) {
            if (value.split(',').length - 1 < 10) {
                callback()
            } else {
                callback(new Error('同义词最多只能有10个'))
            }
        },
```

## 11.中文逗号替换为英文逗号

```javascript
<input onkeyup="this.value = this.value.replace(/，/g,',')" />
```

## 12.Vue-浏览器Tab获得焦点时更新（触发）

```javascript
// 在vue中要放在updated生命周期钩子里
updated() {
        const _this = this
        window.onfocus = function() {
            _this.handleGetSkillList()
            _this.handleGetSkillTypes()
        };
    }
```

## 13.路由中含角色和图标的写法

```javascript
{
  path: 'knowledgeManagement',
name: 'knowledgeManagement',
redirect: '/manage/knowledgeManagement/faq', // 路由转发
component: KnowledgeManagement,
meta: {
    title: '知识管理',  // 可作为浏览器Tab标题
    dropdown: true, // 菜单下拉
    roles: ['knowledge_manager'], // 角色权限控制
    icon: 'icon-knowledge', // icon图标
},
children: [
    {
        path: 'faq',
        name: 'KnowledgeFaq',
        component: KnowledgeFaq,
        meta: {
            title: 'FAQ管理', 
            roles: ['faq_manager'],
            icon: 'icon-faq',
        },
    },
}
```

## 14.antd-upload文件上传

需求：单文件上传，类型限制Excel，大小限制20M，后端上传失败要显示后端的提示信息，并且前端不显示上传失败的文件

template中组件：

```vue
<a-upload-dragger
                  name="file"设置file
                  accept=".xlsx, .xls"文件类型
                  :action="'/xx/xx'"接口路径
                  :multiple="false"选择文件是否能多选
                  :showUploadList="true"显示上传列表
                  :headers="headers"设置headers
                  :file-list="fileList"上传列表
                  :beforeUpload="beforeUpload"上传之前的钩子，校验
                  @change="handleUploadChange"上传成功的回掉
                  :data="{id}"其他需要的参数
                  >
  <p class="ant-upload-drag-icon">
    <hz-icon type="icon-shangchuan1"/>
  </p>
  <p class="ant-upload-text">
    将文件拖拽至此或 <a>点击导入</a>
  </p>
  <p class="ant-upload-hint">
    文件大小限制20M的单个文件
  </p>
  <p class="ant-upload-hint">
    文件格式支持Excel
  </p>
</a-upload-dragger>
```

data()中属性：

```javascript
data() {
  return {
    id: '1',
    fileList: [],
    headers: {
      'authorization': 'authorization-text',
      'X-xx-token': getToken(),
    },
  }
}
```

methods中方法：

```javascript
  // 导入前-校验
  beforeUpload(file) {
    if (file.size / 1024 / 1024 > 20) {
      this.$message.warning('上传失败：上传文件限制20M')
      return false
    }
    return true
  },
  // 导入-回调
  handleUploadChange(info) {
    let fileList = [...info.fileList];
    // 限制文件上传数量为1
    fileList = fileList.slice(-1);
    const status = info.file.status;
    if (status === 'done') {
      if (info.file.response.statusCode === 200) {
        this.$message.success(`${info.file.name} 导入成功`);
        this.handleGetTableList() // 成功后调用查询列表方法来回显
      } else {
        // info.file.response.message获取到的是后端给的错误提示
        this.$message.error(`${info.file.name} 导入失败：` + info.file.response.message);
        fileList = [] // 导入报错不显示错误文件
      }
    } else if (status === 'error') {
      this.$message.error(`${info.file.name} 导入失败：` + info.file.response.message);
      fileList = []
    }
    this.fileList = fileList;
  },
```

## 15.前端下载模版（文件存前端）

单独的js方法，方便多组件调用：

```javascript
// 下载放前端静态资源(/public/static/xxx.xx)里面的模板
export function templateDownload({ url , fileName }) {
    let a = document.createElement('a');
    a.href = url;
    a.download = fileName;
    a.style.display = 'none';
    document.body.appendChild(a);
    a.click();
    a.remove();
}
```

组件中使用：

```javascript
// 下载模板
handDownload() {
  templateDownload({
    url: '/static/xx.xlsx',
    fileName: 'xx.xlsx',
  })
},
```

## 16.antd-tabs根据权限控制隐藏显示

```vue
<a-tabs default-active-key="1" :hasLine="false" :animated="false" v-model="activeKey">
  <a-tab-pane v-for="(item, index) in tabs" :key="(index+1).toString()" :tab="item.tab">
    <!--嵌套展示的其他组件-->
    <component-a v-if="item.tab === 'name1'"></component-a>
    <component-b v-if="item.tab === 'name2'"></component-b>
    <component-c v-if="item.tab === 'name3'"></component-c>
	</a-tab-pane>
</a-tabs>
```

```javascript
data() {
  return {
    activeKey: '1',
    tabs: [],
  }
},
```

```javascript
created() {
  // 判断是否为管理员或有权限的其他用户，控制tabs项展示
  if (this.isAdmin || this.roles.includes('roles1')) {
    this.tabs.push({
      key: '1',
      tab: 'name1',
    })
  }
  if (this.isAdmin || this.roles.includes('roles2')) {
    this.tabs.push({
      key: '2',
      tab: 'name2',
    })
  }
  if (this.isAdmin || this.roles.includes('roles3')) {
    this.tabs.push({
      key: '3',
      tab: 'name3',
    })
  }
}
```

## 17.如果前端需要切换状态，而后端不好提供，则自己维护一个

需求：很多item项以卡片形式展示，每个卡片hover显示“采纳”按钮，点击“采纳”按钮，成功后，按钮状态变为“已采纳”

ps：后端不保存也不返回此状态

解决方案：前端自己维护一个状态，调用采纳接口，成功的时候给这个数据加一个状态

## 18.antd-table中row-key如何使用index

需求：当接口返回的数据没有唯一标识（id）时，使用index

```vue
<a-table
         :columns="columns"
         :data-source="data"
         :row-key="(r,i)=>i.toString()"
         :pagination="false">
</a-table>
```

## 19.http协议下web端浏览器（Chrome）无法使用录音功能

需求：在web端网页实现语音功能

问题：chrome下获取浏览器录音功能，因为安全性问题，需要在localhost或127.0.0.1或https下才能获取权限

解决：

-  浏览器输入 chrome://flags/#unsafely-treat-insecure-origin-as-secure 
-  输入需要获取的链接 选中Enabled 
-  然后点击右下角弹出的Relaunch按钮 重启

## 20. 更改对象中的属姓名（antd+ES6）

```javascript
// `this.form.getFieldsValue()` 是antd中获取form的所有值，结果为Object（对象）
// 方法一
const dataObj = JSON.parse(JSON.stringify(this.form.getFieldsValue()).replace(/name/g, 'userName'))
// 方法二
const { name: userName } = this.form.getFieldsValue()
```

## 21. 基数行添加背景色（css）

```html
<style>
    ul li:nth-of-type(odd){
    background: green;
}
</style>
<ul>
    <li>1</li>
    <li>2</li>
    <li>3</li>
    <li>4</li>
</ul>
```

## 22. antd中的[RangePicker](https://www.antdv.com/components/date-picker-cn/#API)日期选择框设置快捷日期预选按钮（ranges预设时间范围快捷选择）

```html
<a-range-picker
    :ranges="{ '今天': [moment(), moment()], '昨天': [moment().subtract(1, 'day'), moment().subtract(1, 'day')], '近七天': [moment().subtract(6, 'day'), moment()] }"
    :placeholder="['请选择日期', '']"
    separator
    style="width: 220px"
    @change="handleDateChange"
    >
    <hz-icon slot="suffixIcon" type="icon-calendar" />
</a-range-picker>
```

[Moment.js](http://momentjs.cn/) —— JavaScript 日期处理类库

```javascript
import moment from 'moment';

// 处理日期
methods: {
    handleDateChange(values) {
        if (values && values.length > 0) {
            this.startTime = moment(values[0]).format('YYYY-MM-DD 00:00:00')
            this.endTime = moment(values[1]).format('YYYY-MM-DD 23:59:59')
        } else {
            this.startTime = ''
            this.endTime = ''
        }
    },
},
```

## 23. 禁用日期（只可选当天前30天，包含当天）

```javascript
// 禁用日期（只可选当天前30天，包含当天）
disabledDate(current) {
    return current < moment().subtract(29, 'days') || current > moment().add('days')
},
```

## 24. antd-upload上传文件(在上传之前根据文件大小判断是否显示loading)

```javascript
// 文件导入之前的钩子（导入1M以下文件不显示loading）
beforeUploadFile (file) {
  const isFile1M = file.size / 1024 / 1024 < 1;
  if (!isFile1M) {
    this.uploadSpinning = false
  } else {
    this.uploadSpinning = true
  }
  return isFile1M
},
```

## 25. antd-upload上传前自定义校验，未通过则提示且不显示上传文件
```javascript
beforeUpload(file) {
  const size = file.size / 1024 / 1024 > 1
  return new Promise((resolve, reject) => {
    if (size) {
      this.$message.warning('上传文件过大');
      reject(file);
    } else {
      resolve(file);
    }
  });
},
```
## 26. antd-table删除最后一页全部数据，回到上一页
```javascript
/**
 * 当删除最后一页的最后一条数据后，自动获取上一页
 * @param total 总数
 * @param pageNum 当前页码
 * @param pageSize 每页条数
 * @param delNum 要删除的条数
 * @returns {number}
 */
export function calcPageNum (total, pageNum = 1, pageSize = 10, delNum = 1) {
    const restNum = total - pageSize * (pageNum - 1) // 当前页条数
    let pageNumDiff = Math.floor((delNum - restNum) / pageSize) + 1
    pageNumDiff < 0 && (pageNumDiff = 0)
    pageNum = pageNum - pageNumDiff
    pageNum < 1 && (pageNum = 1)
    return pageNum
}
```
```javascript
 this.pageNum = calcPageNum(this.total, this.pageNum, this.pageSize, this.selectedRowKeys.length)
```
## 27. antd-table过长显示滚动条，并且固定操作列
1、按照antd官网的写法，如果不行，就给表格绝对定位就可以显示滚动条了
2、自适应根据屏幕大小是否显示滚动条(重点：`:scroll="{ x: 'max-content' }"`)
```vue
<a-table
    :row-selection="{ selectedRowKeys: selectedRowKeys, onChange: onSelectChange }"
    :style="{ whiteSpace: 'nowrap'}"
    :scroll="{ x: 'max-content' }"
    :columns="columns.filter((col,num)=>{if(col.show || col.show === undefined){return col}})"
    :data-source="data"
    row-key="id"
></a-table>
```
## 28. antd全局修改字体或主题颜色
```javascript
module.exports = {
	css: {
		loaderOptions: {
			less: {
				lessOptions: {
					modifyVars: {
						'font-size-base': '14px',
						'primary-color': '#1F71FF'
					},
					javascriptEnabled: true
				}
			}
		}
	},
}
```
## 29. css溢出的文字显示省略号的颜色与文字颜色一样
```css
div{
	overflow: hidden;
	white-space: nowrap;
	overflow: hidden;
	text-overflow: ellipsis;
	color: #FFFFFF;
	display: inline-block;
}
```
## 30.  eslint配置项的报错:Failed to load config “standard“ to extend from.
下载以下依赖：
```shell
yarn add eslint-plugin-promise eslint-plugin-node eslint-plugin-import eslint-plugin-standard eslint-config-standard -D
```
## 31. antd-upload禁止上传.csv文件
浏览器会把csv当成txt上传，所以需要在beforupload的时候判断一下

## 32. 退回到登录页刷新页面
```javascript
mounted() {
        if (window.history && window.history.pushState) {
            history.pushState(null, null, document.URL)
            window.addEventListener('popstate', () => location.reload(), false)
        }
    },
    destroyed() {
        window.removeEventListener('popstate', this.goBack, false)
    },
```
## 33. a-input同时绑定keydown.enter和blur事件，解决点击enter会调用两次（keydown、blur）
```javascript
<a-input @keyup.enter.native="(e) => e.target.blur()" @blur.prevent="save('formData')"/>
```
## 34. 树搜索、查看已选
```javascript
import { cloneDeep } from 'lodash-es'

export function getTypeById(id) {
    return id.split('/')[0]
}

/** 前端树控件是联动的，需要区分半选和权限，此方法用于区分半选和全选 */
export const getHalfCheckAndCheck = (tree, children = 'children', id = 'uid') => {
    let halfCheck = []
    let check = []
    if (tree && tree.length) {
        tree.forEach((item) => {
            if (item.checked) {
                if (hasChildrenAllChecked(item)) {
                    check.push(item[id])
                } else {
                    halfCheck.push(item[id])
                }
                let checkedObj = getHalfCheckAndCheck(item[children], children, id)
                halfCheck.push(...checkedObj.halfCheck)
                check.push(...checkedObj.check)
            }
        })
    }
    return {
        halfCheck,
        check
    }
}

// 略过第一层
export const getCheck = (tree, children = 'children', id = 'uid') => {
    let halfCheck = []
    let check = []
    if (tree && tree.length) {
        tree.forEach((item) => {
            if (hasChildrenAllChecked(item)) {
                check.push(item[id])
            } else {
                halfCheck.push(item[id])
            }
            let checkedObj = getHalfCheckAndCheck(item[children], children, id)
            halfCheck.push(...checkedObj.halfCheck)
            check.push(...checkedObj.check)
        })
    }
    return {
        halfCheck,
        check
    }
}

// flatTree 平铺树
export const flatTree = (data, id = 'id') => {
    const dataList = []
    for (let i = 0; i < data.length; i++) {
        const node = data[i]
        // const key = node[id];
        dataList.push(node)
        if (node.children) {
            const children = flatTree(node.children, node.key);
            dataList.push(...children)
        }
    }
    return dataList
}

export const getFilterTreeByName = function(tree, value, arr, name = 'title') {
    if (!value) {
        return
    }
    let _tree = cloneDeep(tree)
    _tree.forEach(t => {
        // 自己包含的话，子集全包含
        if (t[name].includes(value)) {
            arr.push(t)
        } else {
            let _children = t.children || []
            t.children = []
            if (_children.length) {
                getFilterTreeByName(_children, value, t.children, name)
                // 子集有长度的话，自己也是被选中的
                if (t.children.length) {
                    arr.push(t)
                }
            }
        }
    })
}

/**
 * 获取选中树
 * @param {Array} check
 * @param {Array} halfCheck
 * @param {Array} tree
 * @param {String} id
 */
export const getCheckedTree = (check, halfCheck = [], tree = [], id = 'uid') => {
    let checkTree = []
    if (tree) {
        tree.forEach((item) => {
            if (check.indexOf('' + item[id]) > -1 || halfCheck.indexOf('' + item[id]) > -1) {
                checkTree.push({
                    ...item,
                    checked: true,
                    children: getCheckedTree(check, halfCheck, item.children, id)
                })
            }
        })
    }
    return checkTree
}

/**
 * 获取选中树(第一层略过)
 * @param {Array} check
 * @param {Array} halfCheck
 * @param {Array} tree
 * @param {String} id
 * @param {String} id
 */
export const getCheckedTree2 = (check, halfCheck = [], tree = [], id = 'uid', parentArray = []) => {
    let checkTree = []
    if (tree) {
        tree.forEach((item) => {
            if (parentArray.indexOf(item[id]) > -1 || (check.indexOf('' + item[id]) > -1 || halfCheck.indexOf('' + item[id])) > -1) {
                checkTree.push({
                    ...item,
                    checked: true,
                    children: getCheckedTree2(check, halfCheck, item.children, id)
                })
            }
        })
    }
    return checkTree
}

/**
 * 修改树的checked字段
 * @param {Array} check
 * @param {Array} halfCheck
 * @param {Array} tree
 * @param {String} id
 */
export const setTreeCheck = (resultId = [], tree, id = 'uid') => {
    if (tree && tree.length) {
        tree.forEach((item) => {
            item.checked = resultId.includes('' + item[id])
            setTreeCheck(resultId, item.children, id)
        })
    }
}

/**
 * 判断children是否全部勾选
 * @param {Array} tree
 * @param {String} children
 */
export function hasChildrenAllChecked(tree, children = 'children') {
    if (!tree || !tree[children] || !tree[children].length) {
        return true
    }
    let flag = true
    for (let i = 0; i < tree[children].length; i++) {
        let childrenList = tree[children][i]
        if (!childrenList.checked) {
            flag = false
            break
        } else if (childrenList.children && childrenList.children.length && !hasChildrenAllChecked(childrenList, children)) {
            flag = false
            break
        }
    }
    return flag
}

/**
 * 获取所有的父节点的id
 * @param {Array} t
 * @param {String} children
 */
export const getParentNode = function (tree, children = 'children', id = 'uid', parentId = []) {
    if (tree) {
        tree.forEach((item) => {
            if (item.children) {
                parentId.push('' + item[id])
                getParentNode(item.children, children, id, parentId)
            }
        })
    }
    return parentId
}
// tree -> array
export const generateList = function(tree) {
    let list = []
    let fn = function (tree) {
        list.push(tree)
        if (tree.children && tree.children.length) {
            tree.children.forEach(n => fn(n))
        }
    }
    fn(tree)
    return list
}

// trees -> array
export const generateListByTrees = function(trees) {
    let list = []
    trees.forEach(tree => {
        let l = generateList(tree)
        list = list.concat(l)
    })
    return list
}

// get targetKey's parentKey from tree
export const getParentKey = (key, tree) => {
    let parentKey
    for (let i = 0; i < tree.length; i++) {
        const node = tree[i]
        if (node.children) {
            if (node.children.some(item => item.key === key)) {
                parentKey = node.key
            } else if (getParentKey(key, node.children)) {
                parentKey = getParentKey(key, node.children)
            }
        }
    }
    return parentKey
}

export function hasChildrenAllNonchecked (t, children = 'children') {
    if (!t || !t[children]) {
        return true
    }
    let flag = true
    for (let i = 0; i < t[children].length; i++) {
        if (t[children][i].checked || !hasChildrenAllNonchecked(t[children][i])) {
            flag = false
            break
        }
    }
    return flag
}

export function traversalTree (data, cb, prev) {
    cb(data, prev)
    data.children && data.children.forEach((child) => {
        traversalTree(child, cb, data)
    })
}
/**
 * 模糊匹配树
 * @param {Array} tree 需要匹配的树
 * @param {string} matchKey 需要匹配的字段
 * @param {string} returnKey 需要返回的字段
 * @param {string} value 匹配的值
 */

export function matchKeysInTree(tree, matchKey = 'name', returnKey = 'id', value) {
    let list = []
    function find(t) {
        if (!t) {
            return
        }
        t.map((item) => {
            console.log(item, value)
            if (item[matchKey].includes(value)) {
                list.push(item[returnKey])
            }
            find(item.children)
        })
    }
    find(tree)
    return list
}
/***
 * 通用接口：
 * 多层级数据扁平化
 */
export const getFlatList = (data = [], dataList = []) => {
    if (!data) {
        return []
    }
    const dataListArr = dataList
    for (let i = 0; i < data.length; i++) {
        const node = data[i]
        dataList.push({ ...node, children: null })
        if (node.children && node.children.length) {
            getFlatList(node.children, dataListArr)
        }
    }
    return dataListArr
}

export const getCheckNode = (data, check, id = 'id') => {
    let checkTree = []
    if (data) {
        data.forEach((item) => {
            if (check.indexOf(item[id]) > -1) {
                checkTree.push({
                    ...item,
                    checked: true,
                    children: getCheckNode(item.children, check, id)
                })
            }
        })
    }
    return checkTree
}

/**
 * 设置树的check属性 方便回显
 * @param check
 * @param halfCheck
 * @param tree
 * @param id
 * @returns {*[]}
 */
export const setTreeChecked = (check, halfCheck = [], tree = [], id = 'uid') => {
    let checkTree = []
    if (tree) {
        tree.forEach((item) => {
            checkTree.push({
                ...item,
                checked: (check.indexOf('' + item[id]) > -1 || halfCheck.indexOf('' + item[id]) > -1),
                children: getCheckedTree(check, halfCheck, item.children, id)
            })
        })
    }
    return checkTree
}

```
使用
```javascript
<template>
    <!--  授权 -->
    <a-modal :visible="visible" title="授权对象" @ok="authOk" @cancel="cancel">
        <a-radio-group v-model="radio" @change="onChangeRadio" class="select-radio">
            <a-radio :style="radioStyle" value="PRIVATE">
                私有
            </a-radio>
            <a-radio :style="radioStyle" value="ALL">
                全部用户
            </a-radio>
            <a-radio :style="radioStyle" value="ORG">
                特定组织结构
            </a-radio>
        </a-radio-group>
        <div v-if="radio === 'ORG'" class="tree-box">
            <a-space>
                <a-input-search
                    class="search-input"
                    v-model="searchStr"
                    placeholder="请输入"
                    style="width:200px;"
                    @change="onSearch"
                />
                <a-checkbox :checked="isView" @change="handleChange">
                    查看已选
                </a-checkbox>
            </a-space>
            <a-tree
                ref="aa"
                v-if="!isView"
                checkable
                :auto-expand-parent="autoExpandParent"
                :defaultExpandAll="defaultExpandAll"
                :checkedKeys="checkedKeys"
                :treeData="renderDataTreeNodes(treeData)"
                :selectedKeys="selectedKeys"
                @expand="onExpand"
                :filterTreeNode="filterTreeNode"
                @check="onCheck"
                :expandedKeys="expandedKeys"
                :autoExpandParent="autoExpandParent"
                :showRightIcon="true"
            >
                <template slot='name' slot-scope="{name}">
                    <span v-html="htmlVal(name)"></span>
                    <!--                         <span v-html="name.replace(new RegExp(searchValue, 'g'),'<span style=color:#f50>' + searchValue + '</span>')"></span>-->
                </template>
            </a-tree>
            <a-tree
                v-else
                :tree-data="renderDataTreeNodes(viewTree) || []"
                ::auto-expand-parent="autoExpandParent"
                :defaultExpandAll="defaultExpandAll"
                :checkedKeys="this.checkedKeys"
                :expandedKeys="this.expandedKeys"
                :selectedKeys="this.selectedKeys"
                :autoExpandParent="this.autoExpandParent"
                :filterTreeNode="this.filterTreeNode"
                :showRightIcon="true"
                @expand="this.onExpand"
                @check="this.onCheck"
            >
                <template slot='name' slot-scope="{name}">
                    <span v-html="htmlVal(name)"></span>
                </template>
            </a-tree>
        </div>
    </a-modal>
</template>

<script>
import {
    getCheckedTree, getFlatList, getHalfCheckAndCheck, getParentNode, setTreeCheck
} from '@utils/tree';
import { authSysOrg, findSysOrgTree } from '@/api';
import { message } from 'hertz-vue';
import { getAllOrg } from '@/modules/RelationalDatabase/api';

export default {
    name: 'Auth',
    props: {
        visible: {
            type: Boolean,
            default: false,
        },
        shareType: {
            type: String,
        },
        orgs: {
            type: Array
        },
    },
    data() {
        return {
            isView: false,
            radio: 'PRIVATE',
            searchStr: null,
            radioStyle: {
                display: 'block',
                height: '30px',
                lineHeight: '30px',
            },
            autoExpandParent: true,
            defaultExpandAll: true,
            checkedKeys: [],
            expandedKeys: [],
            selectedKeys: [],
            treeData: this.orgs,
        }
    },
    watch: {
        visible() {
            this.searchStr = ''
        }
    },
    computed: {
        htmlVal() {
            return (name) => {
                return name.replace(new RegExp(this.searchStr, 'g'), '<span style=color:#f50>' + this.searchStr + '</span>')
            }
        }
    },
    methods: {
        // 获取特定组织结构
        getAllOrgTree() {
            getAllOrg().then(res => {
                if (res.success) {
                    this.treeData = res?.data || []
                }
            }).catch(err => {
                this.$message.error(err.message)
            })
        },
        // 渲染节点
        renderDataTreeNodes(data) {
            if (data.length < 1) {
                return []
            }
            // this.getDataTree(data)
            let tl = data.map((item) => {
                if (item.children) {
                    return {
                        title: item.name,
                        key: item.id + '',
                        dataRef: item,
                        // scopedSlots: { title: 'treeNode', rightIcon: 'right-icon' },
                        scopedSlots: { title: 'treeNode', rightIcon: 'right-icon' },
                        children: this.renderDataTreeNodes(item.children) || [],
                        childrenNum: this.renderDataTreeNodes(item.children).length
                    }
                }
                // project_privileges：针对项目分配做 提示处理
                return {
                    title: item.name,
                    // scopedSlots: { title: 'treeNode', rightIcon: 'right-icon' },
                    scopedSlots: { title: 'treeNode', rightIcon: 'right-icon' },
                    key: item.id + '',
                    dataRef: item,
                    childrenNum: 0
                }
            })
            return tl
        },
        // 高亮搜索的
        filterTreeNode(node) {
            const name = node.dataRef.dataRef.name
            const searchValue = this.searchStr
            let flag = searchValue ? name.includes(searchValue) : false
            return flag
        },
        // 展开/收起节点时触发
        onExpand(expandedKeys) {
            this.expandedKeys = expandedKeys;
            this.autoExpandParent = false;
        },
        // 点击复选框触发
        onCheck(checkedKeys, e) {
            let initTree = this.treeData
            let { halfCheckedKeys } = e
            let resultId = [...checkedKeys, ...halfCheckedKeys]
            // this.checkedKeys = checkedKeys;
            setTreeCheck(resultId, initTree, 'id')
            this.checkedKeys = { checked: checkedKeys, halfChecked: e.halfCheckedKeys }
        },
        // 点击树节点触发
        onChangeRadio() {
            this.searchStr = ''
            this.checkedKeys = []
            this.expandedKeys = []
        },
        handleChange(e) {
            this.isView = e.target.checked
            if (this.isView) {
                this.changeResultData()
            }
        },
        // 查看已选状态值
        changeResultData() {
            let checkedKeys = this.checkedKeys
            let resultTree = []
            let initTree = this.treeData
            let checkObj = getHalfCheckAndCheck(initTree, 'children', 'id')
            // 数字转成字符串
            checkedKeys = checkObj.check.map((item) => {
                return '' + item
            })
            let halfCheck = checkObj.halfCheck.map((item) => {
                return '' + item
            })
            resultTree = getCheckedTree(checkedKeys, halfCheck, initTree, 'id')
            // 默认全部展开
            let expandedKeys = getParentNode(initTree, 'children', 'id')
            this.checkedKeys = checkedKeys
            this.viewTree = resultTree
            this.expandedKeys = expandedKeys
        },
        onSearch() {
            this.searchValue(this.searchStr)
        },
        // 确定
        authOk() {
            console.log(this.checkedKeys, 'this.expandedKeys')
            const treeFlatArr = getFlatList(this.treeData)
            let orgs = []
            const checked = Array.isArray(this.checkedKeys) ? this.checkedKeys : this.checkedKeys.checked
            treeFlatArr.forEach(v => {
                if (checked.indexOf(String(v.id)) > -1) {
                    // orgs.push({
                    //     deptId: v.id,
                    //     deptName: v.name
                    // })
                    orgs.push(v.id)
                }
            })
            // 没有勾选组织的时候不能点确定
            if (this.radio === 'ORG' && !orgs.length) {
                this.$message.error('请选择组织机构')
                return
            }
            console.log(orgs, 'orgs')
            console.log(this.radio, 'this.radio')
            this.$emit('authOk', { orgs, shareType: this.radio })
            // const isPublic = this.radio
            // authSysOrg({ graphId: this.graphId, orgs, isPublic }).then(res => {
            //     if (res.success) {
            //         message.success('操作成功')
            //     } else {
            //         message.error(res.message)
            //     }
            // })
        },
        // 取消
        cancel() {
            this.$emit('cancel')
        }
    },
    mounted() {
        this.getAllOrgTree()
        if (this.shareType) {
            this.radio = this.shareType
        }
        if (this.orgs) {
            this.checkedKeys = { checked: this.orgs }
            // this.expandedKeys = this.orgs
        }
    }
}
</script>

<style scoped lang="less"></style>

```
## 35. vue中<img :src=''>的:src被原样输入，无法显示图片
**原因：**webpack会将`:src`动态绑定的值解析成字符串，原样输出
**解决：**使用`require('')`包裹路径，此时包裹静态地址没问题，例如：`:src="require('../assets/image1.png')"`，但是如果是动态路径的话，会报错：无法找到模块，因为webpack本身是一个预编译的打包工具，无法预测未知变量路径，所以不能require纯变量路径。解决办法是：前置地址必须是静态地址+变量提供图片名称
```vue
<img :src="require(`@/assets/${record.type.toLowerCase()}.svg`)" :alt="record.type"/>
<!-- 或者 -->
<img :src="require(`@/assets/image${id+1}.png`)" alt=""/>
```
## 36. 引入外部项目作为当前项目子模块/子菜单
1、将外部项目（build）打包后放入当前项目public文件夹下
2、在当前项目中配置外部项目的根路由，并渲染
3、配置请求代理
4、创建Farme文件，里面使用Farme标签，其src设为外部项目的入口index的路径
例如：
```vue
<template>
    <div style="height: 100%" class="main-content">
        <a-skeleton active :loading="loading"/>
        <iframe
                v-show="!loading"
                ref="child"
                style="width: 100%; height: 100%"
                :src="src"
                :name="name"
                frameBorder="0"
        />
    </div>
</template>

<script>
export default {
    name: 'RelationalDatabaseFrame',
    props: {
        target: {
            type: String,
            default: '',
        },
        name: {
            type: String,
            default: '',
        },
    },
    data() {
        return {
            src: '',
            height: window.innerHeight - 135,
            loading: true,
        }
    },
    created() {
        const url = '/distNL2SQL/index.html#/RelationalDatabase/'
        // const url = 'http://localhost:8081/#/manage/'
        this.src = url + this.target
    },
    methods: {
        load() {
            const _this = this
            const iframe = this.$refs.child
            // 处理兼容行问题
            if (iframe.attachEvent) {
                iframe.attachEvent('onload', function () {
                    _this.loading = false;
                })
            } else {
                iframe.onload = function () {
                    _this.loading = false;
                }
            }
        }
    },
    mounted() {
        this.load()
    }
}
</script>

<style scoped>
    /deep/ .ant-spin-container {
        height: 100%;
    }
</style>

```
## 37. 水波图
Echart水波图插件：echarts-liquidfill
```shell
yarn add echarts-liquidfill
```
## 38. 置顶公告滚动
左右滚动
![image.png](https://cdn.nlark.com/yuque/0/2022/png/12532486/1665652762895-5e2273e6-6479-47b6-9e0a-0ce4bb59ce1d.png#averageHue=%23eedbd1&clientId=ua0a3ac51-f379-4&from=paste&height=18&id=u3c4345f5&originHeight=36&originWidth=644&originalType=binary&ratio=1&rotation=0&showTitle=false&size=9736&status=done&style=none&taskId=u0f6294f0-5402-4b5e-a356-bbdae050025&title=&width=322)
```vue
<template>
  <div v-if="visible && announcement.length" class="top-announcement">
      <hz-icon class="icon" type="icon-project-close"></hz-icon>
      <div class="announcement-content">
          <div class="item-text">公告：</div>
          <div class="marquee_box" v-if="announcement.length > 30">
              <div id="marquee_left">
                  {{announcement}}
              </div>
          </div>
          <div v-else>{{announcement}}</div>
      </div>
      <hz-icon @click="close" class="close-icon" type="icon-project-close"></hz-icon>
  </div>
</template>

<script>
export default {
    name: 'TopAnnouncement',
    data() {
        return {
            visible: true,
            announcement: '上课的分类快速的减肥了多少减肥路的家乐福健身房dshfksdfh还是大家繁花似锦看到复活节岛上开发啦啦啦啦啦啦啦等等'
        }
    },
    methods: {
        close() {
            this.visible = false
        },
    },
    mounted() {
        const marquee = document.getElementById('marquee_left')
        const contents = marquee.innerHTML
        marquee.innerHTML = contents + contents
    }
}
</script>

<style scoped lang="less">
.top-announcement{
  height: 32px;
  line-height: 32px;
  font-size: 12px;
  font-weight: 400;
  background-color: rgba(255, 148, 49, 0.08);
  color: #FF9431;
  padding: 0 20px;
  display: flex;
  align-items: center;

  .icon{
    margin-right: 7px;
    font-size: 12px;
  }

  .close-icon{
    color: #000000;
    font-size: 12px;
  }

  .announcement-content{
    flex-grow: 1;
    display: flex;

    .item-text{
      width: 40px;
      font-weight: 600;
    }
  }

  .marquee_box{
    width: 100%;
    height: 32px;
    overflow: hidden;
  }
  #marquee_left{
    width: 120%;
  }
  #marquee_left{
    display: inline-block;
    animation: infinite 20s left linear;
  }
  #marquee_left:hover {
    animation-play-state: paused;
  }
  @keyframes left {
    from{
      transform: translateX(0);
    }
    to{
      transform: translateX(-100%);
    }
  }

}
</style>

```
## 39.antd-table自定义scopedSlots的时候ellipsis不生效
**效果：**
![image.png](https://cdn.nlark.com/yuque/0/2022/png/12532486/1667360079287-3f4989d4-3ab1-45a8-824a-a8b547aad67c.png#averageHue=%23e7e9ed&clientId=u7985de19-cfae-4&from=paste&height=41&id=ubf4fc68c&originHeight=82&originWidth=402&originalType=binary&ratio=1&rotation=0&showTitle=false&size=15247&status=done&style=none&taskId=u42a3c861-65e7-4872-8ef8-8cb69142f88&title=&width=201)
**代码：**
显示省略号：
以下scopedSlots使用div标签不显示省略号，使用span标签才显示省略号;
title属性：用于hover显示全部效果
```vue
columns: [
  {
        title: '比对名称',
        dataIndex: 'thanName',
        ellipsis: true,
        scopedSlots: { customRender: 'thanName' }
    }
]
```
```vue
<template slot="thanName" slot-scope="text, record">
  <span :title="record.thanName">
      <i v-if="fileIcon.hasOwnProperty(record.extension)" :class="fileIcon[record.extension]"></i>
      {{record.name}}
  </span>
</template>
```
## 40. antd-table的列多行省略显示效果
**效果：**
![image.png](https://cdn.nlark.com/yuque/0/2022/png/12532486/1667359853288-50b73b6d-c416-4259-b709-4fe3bb7286d1.png#averageHue=%23fefefe&clientId=u7985de19-cfae-4&from=paste&height=68&id=u72133cc2&originHeight=135&originWidth=615&originalType=binary&ratio=1&rotation=0&showTitle=false&size=12431&status=done&style=none&taskId=u50450fd1-559d-436d-a644-973ed66a8f8&title=&width=307.5)
**代码：**
```vue
<template slot="thanName" slot-scope="text, record">
        <span v-for="(item, index) in record.thanName" :key="index" :title="item.name" style="line-height: 22px">
            <template v-if="index < 3">
                <i v-if="fileIcon.hasOwnProperty(item.extension)" :cass="fileIcon[item.extension]" style="margin-right: 6px;"/>
                {{item.name}}<br>
            </template>
        </span>
        <span :title="arrNew(record.thanName)">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;...</span>
</template>
```
```vue
/**
 * 提取对象数组中的某一个属性组成新数组
 * @param obj
 * @returns {*[]}
 */
export const arrNew = (obj) => {
    let arr = [];
    obj.forEach(e => {
        arr.push(e.name)
    })
    return arr
}
```
## 41. 随机生成颜色
方法一：
```vue
function getRandomColor() {
const colorAngle = Math.floor(Math.random() * 360);
    return `hsla(${colorAngle},100%,50%,1)`;
}
```
方法二：
```vue
@random255:`Math.ceil(Math.random()*255)`;
// 使用
header{
  background: rgb(@random255,@random255,@random255);
}
```
## 42. 将文件流转为URL
```javascript
// step2：获取文件字节流
handleGetFile (fileTag) {
  downloadPreviewFile({ fileTag }).then(res => {
    // 根据返回的字节流创建虚拟路径；
    this.pdfUrl = window.URL.createObjectURL(res)
  }).finally(() => {
    this.spinning = false
  })
},
```
## 43. 使用后台返回的URL预览pdf，请求包含很多206
问题：
![image.png](https://cdn.nlark.com/yuque/0/2023/png/12532486/1676445249330-b44e5d52-cbbf-464a-9317-0897eada15f0.png#averageHue=%23dadad9&clientId=u561996e8-c800-4&from=paste&height=424&id=u0810e483&originHeight=848&originWidth=1884&originalType=binary&ratio=2&rotation=0&showTitle=false&size=478532&status=done&style=none&taskId=u3386066c-5236-4124-b87e-1b7836e0f07&title=&width=942)
原因：
## 44.浏览器中预览文件如何下载到本地

1. 按F12或右键-检查打开控制台，点击“网络”（Network）找到下载请求（有的复制请求链接可直接下载，不能直接下载的继续如下操作）
2. 右键复制cURL，如下图：
![image.png](https://cdn.nlark.com/yuque/0/2023/png/12532486/1683779288111-68f64e2a-3fb7-4171-ade5-6824d2e95058.png#averageHue=%23619878&clientId=uc43be107-e478-4&from=paste&height=381&id=u52a82bb5&originHeight=761&originWidth=793&originalType=binary&ratio=2&rotation=0&showTitle=false&size=194890&status=done&style=none&taskId=uccccc013-9ee5-4245-81d8-37322d7f0b9&title=&width=396.5)
3. 打开终端，粘贴cURL，并在后面加上`output xxx.docx`（xxx.docx为文件名 ）回车就可以下载了
4. 如何打开下载文件？命令行输入`open xxx.docx`回车就能打开
## 45.在前端中，如果要转义特殊字符但要保留HTML标签并正确渲染，可以使用第三方库如`DOMPurify`或`he`来完成。

DOMPurify是一个用于保护DOM免受XSS攻击的库，它可以安全地解析和渲染HTML代码。

首先，通过CDN或npm安装DOMPurify：

```html
<script src="http s://cdnjs.cloudflare.com/ajax/libs/dompurify/2.2.9/purify.min.js"></script>
```

然后，使用以下方式转义特殊字符并正确渲染HTML标签：

```javascript
var text = "<p>This is <b>bold</b> text & special characters like >, < and &.</p >";
var sanitizedText = DOMPurify.sanitize(text);

console.log(sanitizedText);
```

这样，`sanitizedText`变量中的值就会是`<p>This is <b>bold</b> text &amp; special characters like &gt;, &lt; and &amp;.</p >`，其中特殊字符被正确转义，而HTML标签也被保留和正确渲染。

如果你不想使用第三方库，你也可以使用JavaScript内置的`createElement`和`appendChild`方法来实现类似的效果，但需要更多的代码来处理和转义特殊字符。
## 46.如果github打不开可以在前面加个k
例如：[https://kgithub.com/](https://kgithub.com/)

